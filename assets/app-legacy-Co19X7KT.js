System.register(["./maps-legacy-DLWhc_uQ.js","./weather-legacy-BrAF-H-8.js","./vendor-legacy-IYe0Xg8N.js"],function(e,t){"use strict";var a,i,r,n,s;return{setters:[e=>{a=e.t,i=e.A,r=e.c},e=>{n=e.c},e=>{s=e.l}],execute:function(){e("initializeApp",async function(){await I.initialize()});const t={primary:"#0066cc",secondary:"#6366f1",background:"#ffffff",surface:"#f8fafc",text:"#1e293b",textSecondary:"#64748b",border:"#e2e8f0",success:"#10b981",warning:"#f59e0b",error:"#ef4444"},o={primary:"#3b82f6",secondary:"#8b5cf6",background:"#0f172a",surface:"#1e293b",text:"#f1f5f9",textSecondary:"#94a3b8",border:"#334155",success:"#34d399",warning:"#fbbf24",error:"#f87171"};class c{listeners=new Map;on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){const a=this.listeners.get(e);a&&(a.delete(t),0===a.size&&this.listeners.delete(e))}emit(e,t){const a=this.listeners.get(e);a&&a.forEach(a=>{try{a(t)}catch(i){console.error(`Error in event listener for ${e}:`,i)}})}once(e,t){const a=(...i)=>{this.off(e,a),t(...i)};this.on(e,a)}destroy(){this.listeners.clear()}}const l=new class extends c{currentTheme="system";prefersDark=!1;mediaQuery;constructor(){super(),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.prefersDark=this.mediaQuery.matches,this.mediaQuery.addEventListener("change",e=>{this.prefersDark=e.matches,"system"===this.currentTheme&&(this.applyTheme(),this.emit("theme-changed",{theme:this.getEffectiveTheme()}))}),this.loadTheme(),this.applyTheme()}loadTheme(){const e=localStorage.getItem("app-theme");e&&["light","dark","system"].includes(e)&&(this.currentTheme=e)}saveTheme(){localStorage.setItem("app-theme",this.currentTheme)}getTheme(){return this.currentTheme}getEffectiveTheme(){return"system"===this.currentTheme?this.prefersDark?"dark":"light":this.currentTheme}getColors(){return"dark"===this.getEffectiveTheme()?o:t}setTheme(e){this.currentTheme!==e&&(this.currentTheme=e,this.saveTheme(),this.applyTheme(),this.emit("theme-changed",{theme:this.getEffectiveTheme()}))}toggleTheme(){const e=this.getEffectiveTheme();this.setTheme("light"===e?"dark":"light")}applyTheme(){const e=this.getEffectiveTheme(),t=this.getColors(),a=document.documentElement;Object.entries(t).forEach(([e,t])=>{a.style.setProperty(`--color-${e}`,t)}),a.setAttribute("data-theme",e);const i=document.querySelector('meta[name="theme-color"]');i&&(i.content=t.primary),this.updateMapStyle(e)}updateMapStyle(e){window.dispatchEvent(new CustomEvent("map-theme-change",{detail:{theme:e}}))}getCSSVariables(){const e=this.getColors(),t={};return Object.entries(e).forEach(([e,a])=>{t[`--color-${e}`]=a}),t}isDark(){return"dark"===this.getEffectiveTheme()}getMapTileURL(){return this.isDark()?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}getMapTileAttribution(){return this.isDark()?'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>':'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}};"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{"UPDATE_AVAILABLE"===e.data?.type&&h.emit("update-available",{available:!0,current:h.getLastUpdateInfo().current,latest:e.data.version||"unknown"})});const h=new class extends c{config;checkTimer;lastCheckTime=0;updateAvailable=!1;latestVersion;constructor(e={}){super(),this.config={checkInterval:18e5,apiEndpoint:"/app/version.json",currentVersion:"2.0.0",autoCheck:!0,...e},this.config.autoCheck&&this.startPeriodicCheck()}async checkForUpdates(e=!1){const t=Date.now();if(!e&&t-this.lastCheckTime<3e5)return this.getLastUpdateInfo();this.lastCheckTime=t,a.track("update_check_started");try{const e=await fetch(this.config.apiEndpoint,{cache:"no-cache",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!e.ok)throw new Error(`Update check failed: ${e.status}`);const t=await e.json(),i=this.compareVersions(t);return this.latestVersion=t,this.updateAvailable=i.available,i.available&&(this.emit("update-available",i),a.track("update_available",{current:i.current,latest:i.latest,urgent:i.urgent})),a.track("update_check_completed",{available:i.available,version:i.latest}),i}catch(i){return console.error("Update check failed:",i),a.track("update_check_failed",{error:i instanceof Error?i.message:"Unknown error"}),{available:!1,current:this.config.currentVersion,latest:this.config.currentVersion}}}compareVersions(e){const t=this.config.currentVersion,a=this.isNewerVersion(e.version,t);return{available:a,current:t,latest:e.version,releaseNotes:a?e:void 0,urgent:a&&e.breaking&&e.breaking.length>0}}isNewerVersion(e,t){const a=e.split(".").map(Number),i=t.split(".").map(Number);for(let r=0;r<Math.max(a.length,i.length);r++){const e=a[r]||0,t=i[r]||0;if(e>t)return!0;if(e<t)return!1}return!1}getLastUpdateInfo(){return{available:this.updateAvailable,current:this.config.currentVersion,latest:this.latestVersion?.version||this.config.currentVersion,releaseNotes:this.updateAvailable?this.latestVersion:void 0,urgent:this.updateAvailable&&this.latestVersion?.breaking&&this.latestVersion.breaking.length>0}}async applyUpdate(){if(!this.updateAvailable)throw new Error("No update available");a.track("update_apply_started");try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration();if(e&&e.waiting)return e.waiting.postMessage({type:"SKIP_WAITING"}),this.emit("update-applied"),void a.track("update_applied",{method:"service_worker"})}this.isNativeApp()?this.redirectToStore():window.location.reload()}catch(e){throw console.error("Update application failed:",e),a.track("update_apply_failed",{error:e instanceof Error?e.message:"Unknown error"}),e}}isNativeApp(){return!!(window.ReactNativeWebView||window.webkit?.messageHandlers||navigator.userAgent.includes("TravelingApp"))}redirectToStore(){const e=navigator.userAgent;e.includes("iPhone")||e.includes("iPad")?window.open("https://apps.apple.com/app/traveling-app","_blank"):e.includes("Android")?window.open("https://play.google.com/store/apps/details?id=com.traveling.app","_blank"):window.location.reload()}startPeriodicCheck(){this.checkTimer=window.setInterval(()=>{this.checkForUpdates()},this.config.checkInterval)}stopPeriodicCheck(){this.checkTimer&&(clearInterval(this.checkTimer),this.checkTimer=void 0)}destroy(){this.stopPeriodicCheck(),super.destroy()}}({currentVersion:"2.0.0"});class d{config;constructor(e={}){this.config={baseUrl:"https://router.project-osrm.org",profile:"driving",...e}}async route(e){const t=performance.now();try{const r=this.getOSRMProfile(e.mode||"car"),n=[e.origin,...e.via||[],e.destination].map(e=>`${e.lng},${e.lat}`).join(";"),s=new URL(`${this.config.baseUrl}/route/v1/${r}/${n}`);s.searchParams.set("overview","full"),s.searchParams.set("geometries","geojson"),s.searchParams.set("steps","true"),s.searchParams.set("annotations","true");const o=await fetch(s.toString());if(!o.ok)throw new i(`OSRM API error: ${o.status}`,"OSRM_API_ERROR",o.status);const c=await o.json();if(!c.routes||0===c.routes.length)throw new i("No route found","NO_ROUTE_FOUND");const l=this.transformRoute(c.routes[0]);return a.track("osrm_route_calculation",{mode:e.mode,has_waypoints:!!e.via?.length,duration:performance.now()-t,distance:l.overview.distance,travel_time:l.overview.duration}),l}catch(r){throw a.track("osrm_route_calculation_error",{mode:e.mode,error:r instanceof Error?r.message:"Unknown error",duration:performance.now()-t}),r}}getOSRMProfile(e){switch(e){case"walk":return"foot";case"bike":return"cycling";default:return"driving"}}transformRoute(e){return{legs:e.legs.map(e=>({start:{lng:e.steps[0]?.intersections[0]?.location[0]||0,lat:e.steps[0]?.intersections[0]?.location[1]||0},end:{lng:e.steps[e.steps.length-1]?.intersections[0]?.location[0]||0,lat:e.steps[e.steps.length-1]?.intersections[0]?.location[1]||0},duration:e.duration,distance:e.distance,steps:e.steps.map(e=>({instruction:e.maneuver.instruction,duration:e.duration,distance:e.distance,start:{lng:e.maneuver.location[0],lat:e.maneuver.location[1]},end:{lng:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1]},polyline:this.encodePolyline(e.geometry.coordinates),maneuver:e.maneuver.type})),polyline:this.encodePolyline(e.steps.flatMap(e=>e.geometry.coordinates))})),overview:{polyline:this.encodePolyline(e.geometry.coordinates),bounds:this.calculateBounds(e.geometry.coordinates),duration:e.duration,distance:e.distance},warnings:[],summary:"OSRM Route"}}calculateBounds(e){const t=e.map(e=>e[0]),a=e.map(e=>e[1]);return{north:Math.max(...a),south:Math.min(...a),east:Math.max(...t),west:Math.min(...t)}}encodePolyline(e){return e.map(e=>`${e[1]},${e[0]}`).join(" ")}}class u extends c{routingProvider;weatherProvider;routeCache=new Map;weatherCache=new Map;cacheTimeout=3e5;constructor(e,t){super(),this.routingProvider=e,this.weatherProvider=t}async calculateWeatherAwareRoute(e,t,i={}){const r=performance.now();try{const n=await this.getBasicRoute(e,t,i);if(!i.weatherAware)return{originalRoute:n,weatherScore:.7,weatherFactors:this.getNeutralWeatherFactors(),recommendation:"proceed",weatherAlerts:[]};const s=await this.analyzeRouteWeather(n),o=this.calculateWeatherScore(s),c=this.generateWeatherRecommendation(o,i);let l=[];i.includeAlternatives&&(o.overall<.6||i.maxAlternatives)&&(l=await this.generateAlternativeRoutes(e,t,n,i));const h={originalRoute:n,weatherScore:o.overall,weatherFactors:o,recommendation:c,weatherAlerts:this.generateWeatherAlerts(s,o),alternativeRoutes:l};return a.track("weather_aware_route_calculated",{weather_score:o.overall,recommendation:c,has_alternatives:l.length>0,duration:performance.now()-r}),this.emit("route-calculated",h),h}catch(n){throw a.track("weather_aware_route_error",{error:n instanceof Error?n.message:"Unknown error",duration:performance.now()-r}),n}}async getBasicRoute(e,t,a){const i=`${e.lat},${e.lng}-${t.lat},${t.lng}-${JSON.stringify(a)}`,r=this.routeCache.get(i);if(r&&Date.now()-r.timestamp<this.cacheTimeout)return r.route;const n=await this.routingProvider.route({origin:e,destination:t,...a});return this.routeCache.set(i,{route:n,timestamp:Date.now()}),n}async analyzeRouteWeather(e){const t=this.extractWeatherCheckpoints(e).map(e=>this.getWeatherForPoint(e));return Promise.all(t)}extractWeatherCheckpoints(e){const t=[];return e.legs.length>0&&(t.push(e.legs[0].start),t.push(e.legs[e.legs.length-1].end)),e.legs.forEach(e=>{if(e.distance>2e4){const a=this.interpolateLatLng(e.start,e.end,.5);t.push(a)}}),t}async getWeatherForPoint(e){const t=`${e.lat.toFixed(3)},${e.lng.toFixed(3)}`,a=this.weatherCache.get(t);if(a&&Date.now()-a.timestamp<this.cacheTimeout)return a.data;const i=await this.weatherProvider.getCurrent(e.lat,e.lng);return this.weatherCache.set(t,{data:i,timestamp:Date.now()}),i}calculateWeatherScore(e){if(0===e.length)return this.getNeutralWeatherFactors();const t=this.aggregateWeatherData(e),a=this.scorePrecipitation(t.precipitation),i=this.scoreTemperature(t.temperature),r=this.scoreVisibility(t.visibility),n=this.scoreWind(t.windSpeed);return{precipitation:a,temperature:i,visibility:r,wind:n,overall:.4*a+.2*i+.3*r+.1*n}}aggregateWeatherData(e){const t=e.length;return{temperature:e.reduce((e,t)=>e+t.temperature,0)/t,precipitation:Math.max(...e.map(e=>e.precipitation||0)),windSpeed:e.reduce((e,t)=>e+(t.windSpeed||0),0)/t,visibility:Math.min(...e.map(e=>e.visibility||10))}}scorePrecipitation(e){return e<=.5?1:e<=2.5?.8:e<=7.5?.5:e<=15?.2:0}scoreTemperature(e){return e>=15&&e<=25?1:e>=10&&e<=30?.8:e>=5&&e<=35?.6:e>=0&&e<=40?.3:.1}scoreVisibility(e){return e>=10?1:e>=5?.8:e>=2?.5:e>=1?.2:0}scoreWind(e){return e<=20?1:e<=40?.8:e<=60?.5:e<=80?.2:0}generateWeatherRecommendation(e,t){const a=t.weatherThreshold||.6;return e.overall>=a?"proceed":e.precipitation<.3||e.visibility<.3?"delay":e.wind<.2||e.overall<.3?"cancel":"indoor_route"}generateWeatherAlerts(e,t){const a=[];if(t.precipitation<.5&&a.push("‚ö†Ô∏è Heavy rain expected along route. Consider delaying travel."),t.visibility<.5&&a.push("üå´Ô∏è Reduced visibility due to fog or weather conditions."),t.wind<.5&&a.push("üí® Strong winds reported. Drive carefully, especially in open areas."),t.temperature<.3){const t=e.reduce((e,t)=>e+t.temperature,0)/e.length;t<0?a.push("üßä Freezing conditions. Watch for ice on roads."):t>35&&a.push("üå°Ô∏è Extremely hot weather. Ensure vehicle cooling and hydration.")}return a}async generateAlternativeRoutes(e,t,a,i){const r=[],n=i.maxAlternatives||2,s=[{...i,routePreference:"shortest"},{...i,avoidHighways:!0},{...i,avoidTolls:!0}];for(const c of s.slice(0,n))try{const n=await this.getBasicRoute(e,t,c);if(this.routesSimilar(a,n))continue;const s=await this.analyzeRouteWeather(n),o=this.calculateWeatherScore(s),l=this.generateWeatherRecommendation(o,i);r.push({originalRoute:n,weatherScore:o.overall,weatherFactors:o,recommendation:l,weatherAlerts:this.generateWeatherAlerts(s,o)})}catch(o){console.warn("Failed to generate alternative route:",o)}return r.sort((e,t)=>t.weatherScore-e.weatherScore)}routesSimilar(e,t){const a=Math.abs(e.overview.distance-t.overview.distance),i=Math.abs(e.overview.duration-t.overview.duration);return a<.1*e.overview.distance&&i<.1*e.overview.duration}getNeutralWeatherFactors(){return{precipitation:.7,temperature:.7,visibility:.7,wind:.7,overall:.7}}interpolateLatLng(e,t,a){return{lat:e.lat+(t.lat-e.lat)*a,lng:e.lng+(t.lng-e.lng)*a}}async updateRouteWeather(e){const t=await this.analyzeRouteWeather(e),a=this.calculateWeatherScore(t);return this.emit("route-weather-updated",a),a}async getRouteForecast(e,t,a){try{const t=await this.weatherProvider.getForecast(e.lat,e.lng),i=a.getHours(),r=t.hourly?.slice(i,i+6)||[],n=this.calculateWeatherScore(r);let s="Good weather for travel";return n.overall<.4?s="Consider delaying travel due to poor weather conditions":n.overall<.6&&(s="Acceptable weather, drive carefully"),{hourlyWeather:r,recommendation:s}}catch(i){return console.warn("Failed to get route forecast:",i),{hourlyWeather:[],recommendation:"Weather data unavailable"}}}clearCache(){this.routeCache.clear(),this.weatherCache.clear()}}class p{constructor(e,t,a){this.placesProvider=e,this.routingProvider=t,this.weatherProvider=a}async createPlan(e){const t=performance.now();try{let i,r=[];e.destination&&(r=await this.placesProvider.search(e.destination,{near:e.origin})),e.constraints.weatherAware&&e.origin&&(i=await this.weatherProvider.getForecast(e.origin.lat,e.origin.lng));const n=await this.findCandidateStops(e,i),s=await this.scoreRecommendations(n,e,i),o=await this.createOptimizedItinerary(s,e);return a.track("ai_plan_created",{destination:e.destination,candidates_count:n.length,recommendations_count:s.length,duration:performance.now()-t,weather_aware:e.constraints.weatherAware}),{plan:o,reasoning:this.generatePlanReasoning(o,s,i),confidence:this.calculatePlanConfidence(o,s),alternatives:[]}}catch(i){throw a.track("ai_plan_creation_error",{error:i instanceof Error?i.message:"Unknown error",duration:performance.now()-t}),i}}async findCandidateStops(e,t){const a=[];if(!e.origin)return a;const i=e.constraints.categories||["meal","scenic","activity"];for(const n of i)try{const t=await this.placesProvider.search(this.getCategorySearchTerm(n),{near:e.origin,radius:1e4,openNow:!0});a.push(...t)}catch(r){console.warn(`Failed to search for ${n}:`,r)}return a}getCategorySearchTerm(e){return{meal:"restaurants cafes food",scenic:"viewpoint scenic attractions parks",activity:"attractions activities things to do",cultural:"museums galleries cultural sites",shopping:"shopping centers markets stores"}[e]||e}async scoreRecommendations(e,t,a){return e.map(e=>{const i={rating:this.scoreRating(e.rating),distance:this.scoreDistance(e,t.origin),weather:this.scoreWeatherFit(e,a),openNow:e.openNow?1:.3,priceLevel:this.scorePriceLevel(e.priceLevel,t.constraints.budget)};return{place:e,score:.3*i.rating+.2*i.distance+.2*i.weather+.2*i.openNow+.1*i.priceLevel,reasoning:this.generateRecommendationReasoning(i,e),category:this.inferCategory(e),estimatedDuration:this.estimateDuration(e),weatherFit:i.weather,detourTime:0}}).sort((e,t)=>t.score-e.score)}scoreRating(e){return e?Math.min(e/5,1):.5}scoreDistance(e,t){if(!t)return.5;const a=this.calculateDistance(t,e.location);return a<=5e3?1:a<=1e4?.8:a<=2e4?.5:.2}scoreWeatherFit(e,t){if(!t||!e.types)return.7;const a=e.types.some(e=>["museum","shopping_mall","restaurant","cafe"].includes(e)),i=e.types.some(e=>["park","tourist_attraction","natural_feature"].includes(e)),r=t.hourly?.[0];return r?r.precipitation>5?a?1:.3:r.temperature>30?a?.9:.6:r.temperature>15&&r.precipitation<1&&i?1:.7:.7}scorePriceLevel(e,t){if(!e||!t)return.7;const a=50*e;return a>=t.min&&a<=t.max?1:a<t.min?.8:a>1.5*t.max?.2:.5}generateRecommendationReasoning(e,t){const a=[];return e.rating>.8&&a.push("highly rated"),e.distance>.8&&a.push("nearby"),e.weather>.8&&a.push("perfect for current weather"),1===e.openNow&&a.push("open now"),a.length>0?`Great choice: ${a.join(", ")}`:"Good option for your trip"}inferCategory(e){return e.types?e.types.includes("restaurant")||e.types.includes("cafe")?"meal":e.types.includes("tourist_attraction")?"scenic":e.types.includes("museum")?"cultural":e.types.includes("shopping_mall")?"shopping":"activity":"other"}estimateDuration(e){return{meal:90,scenic:60,cultural:120,shopping:180,activity:120,other:60}[this.inferCategory(e)]||60}async createOptimizedItinerary(e,t){const a=Math.min(e.length,8),i=e.slice(0,a);return{name:t.destination?`Trip to ${t.destination}`:"Custom Trip",description:"AI-generated trip plan based on your preferences",stops:i.map((e,t)=>({id:`stop-${t}`,place:e.place,category:e.category,priority:Math.max(1,Math.ceil(5*e.score)),duration:e.estimatedDuration,weatherDependent:e.weatherFit<.5,notes:e.reasoning}))}}generatePlanReasoning(e,t,a){const i=[`Selected ${e.stops?.length||0} stops based on ratings, proximity, and your preferences.`];if(a){const e=a.hourly?.[0];e?.precipitation>5?i.push("Prioritized indoor activities due to rain forecast."):e?.temperature>25&&i.push("Balanced indoor and outdoor activities for comfort in warm weather.")}const r=t.filter(e=>e.score>.8).length;return r>0&&i.push(`Included ${r} highly-rated recommendations.`),i.join(" ")}calculatePlanConfidence(e,t){if(!t.length)return 0;const a=t.reduce((e,t)=>e+t.score,0)/t.length,i=t.some(e=>e.score>.8);return Math.min(a+(i?.2:0),1)}calculateDistance(e,t){const a=e.lat*Math.PI/180,i=t.lat*Math.PI/180,r=(t.lat-e.lat)*Math.PI/180,n=(t.lng-e.lng)*Math.PI/180,s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(a)*Math.cos(i)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}}class g extends c{constructor(e,t,a){super(),this.placesProvider=e,this.routingProvider=t,this.weatherProvider=a,this.plannerAgent=new p(e,t,a),this.initializeTools()}plannerAgent;tools=new Map;initializeTools(){this.registerTool({name:"search_places",description:"Search for places near a location",execute:async e=>this.placesProvider.search(e.query,{near:e.location})}),this.registerTool({name:"calculate_route",description:"Calculate route between locations",execute:async e=>this.routingProvider.route(e)}),this.registerTool({name:"get_weather",description:"Get weather information for a location",execute:async e=>e.forecast?this.weatherProvider.getForecast(e.location.lat,e.location.lng):this.weatherProvider.getCurrent(e.location.lat,e.location.lng)})}registerTool(e){this.tools.set(e.name,e)}async processVoiceIntent(e,t){switch(a.track("ai_voice_intent_processed",{intent_type:e.type,confidence:e.confidence}),e.type){case"plan_create":return this.handlePlanCreate(e,t);case"plan_update":return this.handlePlanUpdate(e,t);case"search":return this.handleSearch(e,t);case"navigate":return this.handleNavigate(e,t);case"weather":return this.handleWeather(e,t);default:throw new i(`Unsupported intent type: ${e.type}`,"UNSUPPORTED_INTENT")}}async handlePlanCreate(e,t){const a=e.parameters.destination,i={weatherAware:!0,maxDrivingTime:480,...t?.constraints};return this.plannerAgent.createPlan({destination:a,origin:t?.location,constraints:i,userPreferences:t?.userPreferences})}async handlePlanUpdate(e,t){return{action:"plan_update",parameters:e.parameters}}async handleSearch(e,t){const a=e.parameters.query,r=t?.location,n=this.tools.get("search_places");if(!n)throw new i("Search tool not available","TOOL_NOT_FOUND");return n.execute({query:a,location:r})}async handleNavigate(e,t){return{action:"navigate",parameters:e.parameters}}async handleWeather(e,t){const a=t?.location;if(!a)throw new i("Location required for weather information","LOCATION_REQUIRED");const r=this.tools.get("get_weather");if(!r)throw new i("Weather tool not available","TOOL_NOT_FOUND");return r.execute({location:a,forecast:!0})}async explainRecommendation(e){const t=[`This place has a score of ${(100*e.score).toFixed(0)}% based on multiple factors:`];return e.place.rating&&e.place.rating>4&&t.push(`‚Ä¢ Highly rated (${e.place.rating}‚≠ê) by ${e.place.userRatingsTotal||"many"} visitors`),e.weatherFit>.8?t.push("‚Ä¢ Perfect for current weather conditions"):e.weatherFit<.4&&t.push("‚Ä¢ Consider weather conditions when visiting"),e.detourTime<10&&t.push("‚Ä¢ Very close to your route (minimal detour)"),t.push(`‚Ä¢ Estimated visit duration: ${e.estimatedDuration} minutes`),t.push(`‚Ä¢ Category: ${e.category}`),t.join("\n")}}class m{async get(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.warn(`Failed to get ${e} from localStorage:`,t),null}}async set(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(a){throw console.warn(`Failed to set ${e} in localStorage:`,a),a}}async remove(e){try{localStorage.removeItem(e)}catch(t){console.warn(`Failed to remove ${e} from localStorage:`,t)}}async clear(){try{localStorage.clear()}catch(e){console.warn("Failed to clear localStorage:",e)}}async keys(){try{return Object.keys(localStorage)}catch(e){return console.warn("Failed to get localStorage keys:",e),[]}}}class v{dbName="TravelingAppDB";version=1;storeName="keyvalue";db;async getDB(){return this.db?this.db:new Promise((e,t)=>{const a=indexedDB.open(this.dbName,this.version);a.onerror=()=>t(a.error),a.onsuccess=()=>{this.db=a.result,e(this.db)},a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName)}})}async get(e){try{const t=await this.getDB();return new Promise((a,i)=>{const r=t.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);r.onerror=()=>i(r.error),r.onsuccess=()=>a(r.result)})}catch(t){return console.warn(`Failed to get ${e} from IndexedDB:`,t),null}}async set(e,t){try{const a=await this.getDB();return new Promise((i,r)=>{const n=a.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(t,e);n.onerror=()=>r(n.error),n.onsuccess=()=>i()})}catch(a){throw console.warn(`Failed to set ${e} in IndexedDB:`,a),a}}async remove(e){try{const t=await this.getDB();return new Promise((a,i)=>{const r=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);r.onerror=()=>i(r.error),r.onsuccess=()=>a()})}catch(t){console.warn(`Failed to remove ${e} from IndexedDB:`,t)}}async clear(){try{const e=await this.getDB();return new Promise((t,a)=>{const i=e.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();i.onerror=()=>a(i.error),i.onsuccess=()=>t()})}catch(e){console.warn("Failed to clear IndexedDB:",e)}}async keys(){try{const e=await this.getDB();return new Promise((t,a)=>{const i=e.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys();i.onerror=()=>a(i.error),i.onsuccess=()=>t(i.result)})}catch(e){return console.warn("Failed to get IndexedDB keys:",e),[]}}}class w{data=new Map;async get(e){return this.data.get(e)||null}async set(e,t){this.data.set(e,t)}async remove(e){this.data.delete(e)}async clear(){this.data.clear()}async keys(){return Array.from(this.data.keys())}}const y=new class{adapter;constructor(){this.adapter=this.createAdapter()}createAdapter(){if("undefined"!=typeof indexedDB)try{return new v}catch(e){console.warn("IndexedDB not available, falling back to localStorage")}if("undefined"!=typeof localStorage)try{return localStorage.setItem("__test__","test"),localStorage.removeItem("__test__"),new m}catch(e){console.warn("localStorage not available, falling back to memory storage")}return new w}async get(e){return this.adapter.get(e)}async set(e,t){return this.adapter.set(e,t)}async remove(e){return this.adapter.remove(e)}async clear(){return this.adapter.clear()}async keys(){return this.adapter.keys()}async getNumber(e,t=0){const a=await this.get(e);return"number"==typeof a?a:t}async getString(e,t=""){const a=await this.get(e);return"string"==typeof a?a:t}async getBoolean(e,t=!1){const a=await this.get(e);return"boolean"==typeof a?a:t}async getArray(e,t=[]){const a=await this.get(e);return Array.isArray(a)?a:t}async getObject(e,t=null){const a=await this.get(e);return a&&"object"==typeof a?a:t}async setMany(e){await Promise.all(Object.entries(e).map(([e,t])=>this.set(e,t)))}async getMany(e){return(await Promise.all(e.map(async e=>({key:e,value:await this.get(e)})))).reduce((e,{key:t,value:a})=>(e[t]=a,e),{})}async setWithTTL(e,t,a){const i=Date.now()+a;await this.set(e,{value:t,expiry:i})}async getWithTTL(e){const t=await this.get(e);return t&&"object"==typeof t&&t.expiry?Date.now()>t.expiry?(await this.remove(e),null):t.value:null}},f=new class extends c{currentPlan;plans=new Map;constructor(){super(),this.loadPlans()}async createPlan(e,t,i,r){const n={id:this.generateId(),name:e,description:t,startDate:i||new Date,endDate:r||new Date(Date.now()+864e5),stops:[],metadata:{created:new Date,updated:new Date,version:1}};return this.plans.set(n.id,n),this.currentPlan=n,await this.savePlans(),a.track("trip_plan_created",{plan_id:n.id,has_description:!!t,duration_days:Math.ceil((n.endDate.getTime()-n.startDate.getTime())/864e5)}),this.emit("plan-created",n),n}async updatePlan(e,t){const r=this.plans.get(e);if(!r)throw new i("Trip plan not found","PLAN_NOT_FOUND");const n={...r,...t,id:r.id,metadata:{...r.metadata,updated:new Date,version:r.metadata.version+1}},s=this.validatePlan(n);if(!s.valid)throw new i(`Plan validation failed: ${s.errors.join(", ")}`,"PLAN_VALIDATION_FAILED");return this.plans.set(e,n),this.currentPlan?.id===e&&(this.currentPlan=n),await this.savePlans(),a.track("trip_plan_updated",{plan_id:e,stops_count:n.stops.length,has_route:!!n.route}),this.emit("plan-updated",n),n}async deletePlan(e){if(!this.plans.get(e))throw new i("Trip plan not found","PLAN_NOT_FOUND");this.plans.delete(e),this.currentPlan?.id===e&&(this.currentPlan=void 0),await this.savePlans(),a.track("trip_plan_deleted",{plan_id:e}),this.emit("plan-deleted",e)}async addStop(e,t,r){const n=this.plans.get(e);if(!n)throw new i("Trip plan not found","PLAN_NOT_FOUND");const s={id:this.generateId(),place:t,category:r.category,priority:r.priority||3,arrivalTime:r.arrivalTime,departureTime:r.departureTime,duration:r.duration,notes:r.notes,weatherDependent:r.weatherDependent||!1};return void 0!==r.insertIndex&&r.insertIndex>=0?n.stops.splice(r.insertIndex,0,s):n.stops.push(s),await this.updatePlan(e,{stops:n.stops}),a.track("trip_stop_added",{plan_id:e,stop_id:s.id,category:s.category,has_timing:!(!s.arrivalTime&&!s.departureTime),weather_dependent:s.weatherDependent}),this.emit("stop-added",{planId:e,stop:s}),s}async updateStop(e,t,r){const n=this.plans.get(e);if(!n)throw new i("Trip plan not found","PLAN_NOT_FOUND");const s=n.stops.findIndex(e=>e.id===t);if(-1===s)throw new i("Stop not found","STOP_NOT_FOUND");const o={...n.stops[s],...r,id:t};return n.stops[s]=o,await this.updatePlan(e,{stops:n.stops}),a.track("trip_stop_updated",{plan_id:e,stop_id:t}),this.emit("stop-updated",{planId:e,stop:o}),o}async removeStop(e,t){const r=this.plans.get(e);if(!r)throw new i("Trip plan not found","PLAN_NOT_FOUND");const n=r.stops.findIndex(e=>e.id===t);if(-1===n)throw new i("Stop not found","STOP_NOT_FOUND");r.stops.splice(n,1),await this.updatePlan(e,{stops:r.stops}),a.track("trip_stop_removed",{plan_id:e,stop_id:t}),this.emit("stop-removed",{planId:e,stopId:t})}async reorderStops(e,t,r){const n=this.plans.get(e);if(!n)throw new i("Trip plan not found","PLAN_NOT_FOUND");if(t<0||t>=n.stops.length||r<0||r>=n.stops.length)throw new i("Invalid stop indices","INVALID_INDICES");const[s]=n.stops.splice(t,1);n.stops.splice(r,0,s),await this.updatePlan(e,{stops:n.stops}),a.track("trip_stops_reordered",{plan_id:e,from_index:t,to_index:r}),this.emit("stops-reordered",{planId:e,fromIndex:t,toIndex:r})}validatePlan(e){const t=[],a=[];e.name.trim()||t.push("Plan name is required"),e.endDate<=e.startDate&&t.push("End date must be after start date");for(let r=0;r<e.stops.length;r++){const i=e.stops[r],n=`Stop ${r+1}`;if(i.place.name||t.push(`${n}: Place name is required`),i.place.location.lat&&i.place.location.lng||t.push(`${n}: Valid location coordinates are required`),i.arrivalTime&&i.departureTime){i.departureTime<=i.arrivalTime&&t.push(`${n}: Departure time must be after arrival time`);const e=i.departureTime.getTime()-i.arrivalTime.getTime(),r=60*(i.duration||60)*1e3;Math.abs(e-r)>18e5&&a.push(`${n}: Duration mismatch between times and specified duration`)}if(r<e.stops.length-1){const a=e.stops[r+1];i.departureTime&&a.arrivalTime&&i.departureTime>a.arrivalTime&&t.push(`${n}: Departure time overlaps with next stop's arrival time`)}if(i.duration){const e={meal:180,scenic:120,activity:480,accommodation:720,fuel:30,shopping:240,cultural:360,other:480}[i.category];i.duration>e&&a.push(`${n}: Duration (${i.duration} min) seems unusually long for ${i.category}`),i.duration<5&&"fuel"!==i.category&&a.push(`${n}: Duration (${i.duration} min) seems too short`)}}const i=Math.ceil((e.endDate.getTime()-e.startDate.getTime())/864e5);return i>30&&a.push("Trip duration is very long (> 30 days)"),e.stops.length/i>10&&a.push("Very high number of stops per day - consider reducing for a more relaxed trip"),{valid:0===t.length,errors:t,warnings:a}}optimizeStopOrder(e,t){return Promise.resolve(this.plans.get(e))}getPlan(e){return this.plans.get(e)}getCurrentPlan(){return this.currentPlan}getAllPlans(){return Array.from(this.plans.values()).sort((e,t)=>t.metadata.updated.getTime()-e.metadata.updated.getTime())}setCurrentPlan(e){const t=this.plans.get(e);t&&(this.currentPlan=t,this.emit("current-plan-changed",t))}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async loadPlans(){try{(await y.get("trip-plans")||[]).forEach(e=>{e.startDate=new Date(e.startDate),e.endDate=new Date(e.endDate),e.metadata.created=new Date(e.metadata.created),e.metadata.updated=new Date(e.metadata.updated),e.stops.forEach(e=>{e.arrivalTime&&(e.arrivalTime=new Date(e.arrivalTime)),e.departureTime&&(e.departureTime=new Date(e.departureTime))}),this.plans.set(e.id,e)});const e=await y.get("current-plan-id");e&&(this.currentPlan=this.plans.get(e))}catch(e){console.warn("Failed to load plans:",e)}}async savePlans(){try{const e=Array.from(this.plans.values());await y.set("trip-plans",e),this.currentPlan&&await y.set("current-plan-id",this.currentPlan.id)}catch(e){console.warn("Failed to save plans:",e)}}};class _{recognition;isActive=!1;config;eventBus;constructor(e,t){this.config=e,this.eventBus=t,this.initializeRecognition()}initializeRecognition(){if(!this.isSupported())return;const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new e,this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives,this.recognition.onstart=()=>{this.isActive=!0,this.eventBus.emit("stt-started"),a.track("voice_recognition_started")},this.recognition.onend=()=>{this.isActive=!1,this.eventBus.emit("stt-ended"),a.track("voice_recognition_ended")},this.recognition.onresult=e=>{const t=Array.from(e.results),i=t.map(e=>e[0].transcript).join(" "),r=t.length>0?t[0][0].confidence:0;this.eventBus.emit("stt-result",{transcript:i,confidence:r}),a.track("voice_recognition_result",{transcript_length:i.length,confidence:r,is_final:e.results[e.results.length-1].isFinal})},this.recognition.onerror=e=>{this.isActive=!1,this.eventBus.emit("stt-error",e.error),a.track("voice_recognition_error",{error:e.error})}}async startListening(){if(this.recognition&&!this.isActive)try{this.recognition.start()}catch(e){throw new i("Failed to start speech recognition","STT_START_FAILED")}}async stopListening(){this.recognition&&this.isActive&&this.recognition.stop()}isListening(){return this.isActive}isSupported(){return!(!window.SpeechRecognition&&!window.webkitSpeechRecognition)}}class T{patterns={plan_create:[/plan.*trip.*to\s+(.+)/i,/create.*plan.*for\s+(.+)/i,/◊™◊õ◊†◊ü.*◊ò◊ô◊ï◊ú.*◊ú(.+)/i,/◊¶◊ï◊®.*◊™◊ï◊õ◊†◊ô◊™.*◊ú(.+)/i],plan_update:[/add.*stop.*at\s+(.+)/i,/include.*(.+).*in.*plan/i,/◊î◊ï◊°◊£.*◊¢◊¶◊ô◊®◊î.*◊ë(.+)/i,/◊õ◊ú◊ï◊ú.*(.+).*◊ë◊™◊ï◊õ◊†◊ô◊™/i],search:[/find.*(.+)/i,/search.*for\s+(.+)/i,/look.*for\s+(.+)/i,/◊û◊¶◊ê.*(.+)/i,/◊ó◊§◊©.*(.+)/i],navigate:[/navigate.*to\s+(.+)/i,/directions.*to\s+(.+)/i,/go.*to\s+(.+)/i,/◊†◊ï◊ï◊ò.*◊ú(.+)/i,/◊î◊ï◊®◊ê◊ï◊™.*◊ú(.+)/i],weather:[/weather.*(?:in|at|for)\s+(.+)/i,/◊û◊ñ◊í.*◊ê◊ï◊ï◊ô◊®.*◊ë(.+)/i]};async parse(e){const t=e.trim().toLowerCase();for(const[a,i]of Object.entries(this.patterns))for(const r of i){const i=t.match(r);if(i)return{type:a,confidence:.8,parameters:this.extractParameters(a,i),original:e}}return{type:"search",confidence:.5,parameters:{query:e},original:e}}extractParameters(e,t){const a=t[1]||"";switch(e){case"plan_create":return{destination:a.trim()};case"plan_update":return{place:a.trim()};case"search":case"navigate":return{query:a.trim()};case"weather":return{location:a.trim()};default:return{text:a.trim()}}}}const k=new class extends c{sttProvider;intentParser;isInitialized=!1;constructor(){super(),this.sttProvider=new _({language:"he-IL",continuous:!1,interimResults:!0,maxAlternatives:3},this),this.intentParser=new T,this.setupEventHandlers()}setupEventHandlers(){this.on("stt-result",async({transcript:e,confidence:t})=>{try{const t=await this.intentParser.parse(e);this.emit("intent-recognized",t),a.track("voice_intent_recognized",{intent_type:t.type,confidence:t.confidence,has_parameters:Object.keys(t.parameters).length>0})}catch(i){console.error("Intent parsing failed:",i),this.emit("intent-error",i)}}),this.on("stt-error",e=>{this.emit("voice-error",new i(`Speech recognition error: ${e}`,"STT_ERROR"))})}async initialize(){if(!this.isInitialized){if(!this.sttProvider.isSupported())throw new i("Speech recognition not supported","STT_NOT_SUPPORTED");this.isInitialized=!0,a.track("voice_manager_initialized")}}async startListening(){await this.initialize(),await this.sttProvider.startListening(),this.emit("listening-started")}async stopListening(){await this.sttProvider.stopListening(),this.emit("listening-stopped")}isListening(){return this.sttProvider.isListening()}isSupported(){return this.sttProvider.isSupported()}speak(e,t={}){return new Promise((r,n)=>{if(!("speechSynthesis"in window))return void n(new i("Text-to-speech not supported","TTS_NOT_SUPPORTED"));const s=new SpeechSynthesisUtterance(e);s.lang=t.language||"he-IL",s.rate=t.rate||.9,s.pitch=t.pitch||1,s.volume=t.volume||.8,s.onend=()=>{a.track("voice_tts_completed",{text_length:e.length}),r()},s.onerror=e=>{a.track("voice_tts_error",{error:e.error}),n(new i(`Text-to-speech error: ${e.error}`,"TTS_ERROR"))},speechSynthesis.speak(s),a.track("voice_tts_started",{text_length:e.length})})}stopSpeaking(){"speechSynthesis"in window&&speechSynthesis.cancel()}isSpeaking(){return"speechSynthesis"in window&&speechSynthesis.speaking}async startPressAndHold(){await this.startListening(),document.body.classList.add("voice-listening")}async endPressAndHold(){await this.stopListening(),document.body.classList.remove("voice-listening")}async processQuickCommand(e){const t=await this.intentParser.parse(e);return this.emit("intent-recognized",t),t}},P=new class extends c{state={isNavigating:!1,currentLeg:0,currentStep:0,distanceToNextStep:0,estimatedTimeRemaining:0};settings={voiceGuidance:!0,units:"metric",avoidTolls:!1,routePreference:"fastest"};watchId;lastAnnouncedStep=-1;constructor(){super(),this.loadSettings()}async startNavigation(e,t=0){try{this.state={isNavigating:!0,currentRoute:e,currentLeg:0,currentStep:t,distanceToNextStep:0,estimatedTimeRemaining:e.overview.duration},await this.startLocationTracking(),this.emit("navigation-started",this.state),a.track("navigation_started",{total_distance:e.overview.distance,total_duration:e.overview.duration,legs_count:e.legs.length}),this.settings.voiceGuidance&&this.announceNextInstruction()}catch(i){throw a.track("navigation_start_error",{error:i instanceof Error?i.message:"Unknown error"}),i}}async stopNavigation(){this.state.isNavigating=!1,this.stopLocationTracking(),this.emit("navigation-stopped"),a.track("navigation_stopped",{was_completed:this.isNavigationComplete()})}async pauseNavigation(){this.stopLocationTracking(),this.emit("navigation-paused"),a.track("navigation_paused")}async resumeNavigation(){if(!this.state.currentRoute)throw new i("No active route to resume","NO_ACTIVE_ROUTE");await this.startLocationTracking(),this.emit("navigation-resumed"),a.track("navigation_resumed")}async startLocationTracking(){if(!navigator.geolocation)throw new i("Geolocation not supported","GEOLOCATION_NOT_SUPPORTED");return new Promise((e,t)=>{const a={enableHighAccuracy:!0,timeout:1e4,maximumAge:1e3};navigator.geolocation.getCurrentPosition(t=>{this.updateLocation({lat:t.coords.latitude,lng:t.coords.longitude}),this.watchId=navigator.geolocation.watchPosition(e=>{this.updateLocation({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Location tracking error:",e),this.emit("navigation-error",new i(`Location tracking failed: ${e.message}`,"LOCATION_TRACKING_FAILED"))},a),e()},e=>{t(new i(`Failed to get initial location: ${e.message}`,"INITIAL_LOCATION_FAILED"))},a)})}stopLocationTracking(){void 0!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=void 0)}updateLocation(e){this.state.currentLocation=e,this.state.currentRoute&&this.state.isNavigating&&(this.updateNavigationProgress(e),this.emit("location-updated",{location:e,state:this.state}))}updateNavigationProgress(e){if(!this.state.currentRoute)return;const t=this.state.currentRoute.legs[this.state.currentLeg];if(!t)return;const a=t.steps[this.state.currentStep];a&&(this.state.distanceToNextStep=this.calculateDistance(e,a.end),this.state.distanceToNextStep<20&&this.advanceToNextStep(),this.updateEstimatedTime(),this.checkVoiceAnnouncements())}advanceToNextStep(){if(!this.state.currentRoute)return;const e=this.state.currentRoute.legs[this.state.currentLeg];if(e){if(this.state.currentStep++,this.state.currentStep>=e.steps.length){if(this.state.currentLeg++,this.state.currentStep=0,this.state.currentLeg>=this.state.currentRoute.legs.length)return void this.completeNavigation();this.emit("leg-completed",{completedLeg:this.state.currentLeg-1,currentLeg:this.state.currentLeg})}this.settings.voiceGuidance&&this.announceNextInstruction(),this.emit("step-advanced",this.state),a.track("navigation_step_advanced",{leg:this.state.currentLeg,step:this.state.currentStep})}}completeNavigation(){this.state.isNavigating=!1,this.stopLocationTracking(),this.emit("navigation-completed"),a.track("navigation_completed",{total_legs:this.state.currentRoute?.legs.length,final_leg:this.state.currentLeg,final_step:this.state.currentStep}),this.settings.voiceGuidance&&this.speak("You have arrived at your destination!")}updateEstimatedTime(){if(!this.state.currentRoute)return;let e=0;e+=this.state.distanceToNextStep;const t=this.state.currentRoute.legs[this.state.currentLeg];if(t)for(let a=this.state.currentStep+1;a<t.steps.length;a++)e+=t.steps[a].distance;for(let a=this.state.currentLeg+1;a<this.state.currentRoute.legs.length;a++)e+=this.state.currentRoute.legs[a].distance;this.state.estimatedTimeRemaining=Math.round(e/(5e4/3600))}checkVoiceAnnouncements(){if(!this.settings.voiceGuidance)return;if(!this.state.currentRoute)return;const e=this.state.currentRoute.legs[this.state.currentLeg];e&&e.steps[this.state.currentStep]&&this.state.distanceToNextStep<=100&&this.lastAnnouncedStep!==this.state.currentStep&&(this.announceNextInstruction(),this.lastAnnouncedStep=this.state.currentStep)}announceNextInstruction(){if(!this.state.currentRoute)return;const e=this.state.currentRoute.legs[this.state.currentLeg];if(!e)return;const t=this.state.currentStep+1,a=e.steps[t];if(a){const e=`In ${this.formatDistance(this.state.distanceToNextStep)}, ${a.instruction}`;this.speak(e)}}speak(e){if("speechSynthesis"in window){const t=new SpeechSynthesisUtterance(e);t.rate=.9,t.volume=.8,speechSynthesis.speak(t)}}formatDistance(e){if("imperial"===this.settings.units){const t=3.28084*e;return t<1e3?`${Math.round(t)} feet`:`${(t/5280).toFixed(1)} miles`}return e<1e3?`${Math.round(e)} meters`:`${(e/1e3).toFixed(1)} kilometers`}calculateDistance(e,t){const a=e.lat*Math.PI/180,i=t.lat*Math.PI/180,r=(t.lat-e.lat)*Math.PI/180,n=(t.lng-e.lng)*Math.PI/180,s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(a)*Math.cos(i)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}getState(){return{...this.state}}getCurrentInstruction(){if(!this.state.currentRoute)return"";const e=this.state.currentRoute.legs[this.state.currentLeg];if(!e)return"";const t=e.steps[this.state.currentStep];return t?.instruction||""}getUpcomingInstructions(e=3){if(!this.state.currentRoute)return[];if(!this.state.currentRoute.legs[this.state.currentLeg])return[];const t=[];let a=this.state.currentStep+1,i=this.state.currentLeg;for(;t.length<e&&i<this.state.currentRoute.legs.length;){const e=this.state.currentRoute.legs[i];a<e.steps.length?(t.push(e.steps[a]),a++):(i++,a=0)}return t}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings(),this.emit("settings-updated",this.settings)}getSettings(){return{...this.settings}}loadSettings(){try{const e=localStorage.getItem("navigation-settings");e&&(this.settings={...this.settings,...JSON.parse(e)})}catch(e){console.warn("Failed to load navigation settings:",e)}}saveSettings(){try{localStorage.setItem("navigation-settings",JSON.stringify(this.settings))}catch(e){console.warn("Failed to save navigation settings:",e)}}isNavigationComplete(){return!!this.state.currentRoute&&this.state.currentLeg>=this.state.currentRoute.legs.length}simulateLocation(e){}simulateProgress(e,t){}};class S extends c{map;config;layers={route:s.layerGroup(),places:s.layerGroup(),user:s.layerGroup()};currentLocation;constructor(e){super(),this.config=e}async initialize(){const e=document.getElementById("map");if(!e)throw new Error("Map container not found");this.map=s.map(e,{center:this.config.center||[32.0853,34.7818],zoom:this.config.zoom||13,zoomControl:!0,attributionControl:!0}),this.updateMapTiles(),Object.values(this.layers).forEach(e=>{e.addTo(this.map)}),this.setupMapEvents(),a.track("map_initialized",{center:this.config.center,zoom:this.config.zoom})}updateMapTiles(){this.map&&(this.map.eachLayer(e=>{e instanceof s.TileLayer&&this.map.removeLayer(e)}),s.tileLayer(l.getMapTileURL(),{attribution:l.getMapTileAttribution(),maxZoom:19}).addTo(this.map))}setupMapEvents(){this.map&&(this.map.on("click",e=>{this.emit("map-clicked",{location:e.latlng}),a.track("map_clicked",{lat:e.latlng.lat,lng:e.latlng.lng,zoom:this.map.getZoom()})}),this.map.on("zoomend",()=>{this.emit("zoom-changed",{zoom:this.map.getZoom()})}),this.map.on("moveend",()=>{const e=this.map.getCenter();this.emit("center-changed",{center:e})}))}updateTheme(e){this.updateMapTiles(),a.track("map_theme_updated",{theme:e})}setCenter(e,t){this.map&&(this.map.setView([e.lat,e.lng],t||this.map.getZoom()),this.emit("center-changed",{center:e}))}addPlace(e,t={}){if(!this.map)throw new Error("Map not initialized");const i=s.marker([e.location.lat,e.location.lng]).bindPopup(`\n        <div class="place-popup">\n          <h3>${e.name}</h3>\n          ${e.address?`<p>${e.address}</p>`:""}\n          ${e.rating?`<div>‚≠ê ${e.rating} (${e.userRatingsTotal||0} reviews)</div>`:""}\n          <div class="popup-actions">\n            <button onclick="window.mapManager.focusPlace('${e.id}')">Details</button>\n            <button onclick="window.mapManager.navigateToPlace('${e.id}')">Navigate</button>\n          </div>\n        </div>\n      `);return i.addTo(this.layers.places),t.showPopup&&i.openPopup(),t.focus&&this.setCenter(e.location,16),a.track("place_added_to_map",{place_id:e.id,show_popup:t.showPopup,focus:t.focus}),i}addRoute(e,t={}){if(!this.map)throw new Error("Map not initialized");const i=this.decodePolyline(e.overview.polyline),r=s.polyline(i,{color:t.color||"#3b82f6",weight:t.weight||5,opacity:.8});if(r.addTo(this.layers.route),e.legs.length>0){const t=e.legs[0],a=e.legs[e.legs.length-1];s.marker([t.start.lat,t.start.lng]).bindPopup("Start").addTo(this.layers.route),s.marker([a.end.lat,a.end.lng]).bindPopup("Destination").addTo(this.layers.route)}return this.map.fitBounds(r.getBounds(),{padding:[20,20]}),a.track("route_added_to_map",{distance:e.overview.distance,duration:e.overview.duration,legs_count:e.legs.length}),r}setUserLocation(e,t){this.map&&(this.currentLocation=e,this.layers.user.clearLayers(),s.marker([e.lat,e.lng],{icon:s.divIcon({className:"user-location-marker",html:'<div class="user-location-dot"></div>',iconSize:[20,20],iconAnchor:[10,10]})}).bindPopup("Your location").addTo(this.layers.user),t&&s.circle([e.lat,e.lng],{radius:t,weight:1,color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.1}).addTo(this.layers.user),this.emit("user-location-updated",{location:e,accuracy:t}))}getCurrentLocation(){return this.currentLocation}clearPlaces(){this.layers.places.clearLayers()}clearRoute(){this.layers.route.clearLayers()}clearAll(){Object.values(this.layers).forEach(e=>e.clearLayers())}focusPlace(e){this.emit("place-focused",{placeId:e})}navigateToPlace(e){this.emit("navigation-requested",{placeId:e})}decodePolyline(e){const t=[];let a=0;const i=e.length;let r=0,n=0;for(;a<i;){let i,s=0,o=0;do{i=e.charCodeAt(a++)-63,o|=(31&i)<<s,s+=5}while(i>=32);r+=1&o?~(o>>1):o>>1,s=0,o=0;do{i=e.charCodeAt(a++)-63,o|=(31&i)<<s,s+=5}while(i>=32);n+=1&o?~(o>>1):o>>1,t.push([r/1e5,n/1e5])}return t}destroy(){this.map&&(this.map.remove(),this.map=void 0),super.destroy()}}"undefined"!=typeof window&&(window.mapManager={focusPlace:e=>{window.dispatchEvent(new CustomEvent("place-focus",{detail:{placeId:e}}))},navigateToPlace:e=>{window.dispatchEvent(new CustomEvent("navigation-request",{detail:{placeId:e}}))}});class b extends c{config;isInitialized=!1;currentView="search";constructor(e){super(),this.config=e}async initialize(){this.isInitialized||(this.setupNavigation(),this.setupVoiceUI(),this.setupPlanningUI(),this.setupSearchUI(),this.setupUpdateUI(),this.setupThemeToggle(),this.isInitialized=!0,a.track("ui_manager_initialized"))}setupNavigation(){const e=document.querySelectorAll(".nav-item, .nav-btn"),t=document.querySelectorAll(".mobile-view, .app-view");e.forEach(i=>{i.addEventListener("click",()=>{const r=i.getAttribute("data-view");if(!r)return;e.forEach(e=>e.classList.remove("active")),i.classList.add("active"),t.forEach(e=>e.classList.remove("active"));const n=document.querySelector(`[data-view="${r}"]`);n&&n.classList.add("active"),this.currentView=r,this.emit("view-changed",{view:r}),a.track("view_changed",{view:r}),this.handleViewChange(r)})})}handleViewChange(e){switch(e){case"map":this.emit("map-view-activated");break;case"trip":this.initializeTripPlanning();break;case"ai":this.initializeAIInterface();break;case"voice":this.initializeVoiceInterface()}}setupVoiceUI(){const e=document.getElementById("voiceBtn");if(!e)return;let t=!1;const i=async()=>{if(!t){t=!0;try{await this.config.voiceManager.startPressAndHold(),e.classList.add("listening"),this.showVoiceStatus("Listening... Release to stop"),a.track("voice_press_and_hold_started")}catch(i){console.error("Voice listening failed:",i),this.showVoiceStatus("Voice not available"),t=!1}}},r=async()=>{if(t){t=!1;try{await this.config.voiceManager.endPressAndHold(),e.classList.remove("listening"),this.showVoiceStatus("Processing..."),a.track("voice_press_and_hold_ended")}catch(i){console.error("Voice stop failed:",i),this.showVoiceStatus("")}}};e.addEventListener("mousedown",i),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",r),e.addEventListener("touchstart",e=>{e.preventDefault(),i()}),e.addEventListener("touchend",e=>{e.preventDefault(),r()}),e.addEventListener("touchcancel",r)}setupPlanningUI(){document.querySelectorAll(".duration-option").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".duration-option").forEach(e=>e.classList.remove("selected")),e.classList.add("selected")})}),document.querySelectorAll(".interest-option").forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("selected"),document.querySelectorAll(".interest-option.selected").length>4&&(e.classList.remove("selected"),this.showNotification("Maximum 4 interests allowed","warning"))})});const e=document.getElementById("budgetRange"),t=document.getElementById("budgetAmount");e&&t&&e.addEventListener("input",()=>{t.textContent=e.value});const a=document.getElementById("generateTripBtn");a&&a.addEventListener("click",this.handleTripGeneration.bind(this))}async handleTripGeneration(){const e=document.getElementById("generateTripBtn"),t=document.getElementById("tripGenerationStatus");if(e&&t){e.disabled=!0,e.textContent="Generating...",t.textContent="Creating your perfect trip...";try{const e=this.getSelectedDuration(),i=this.getSelectedInterests(),r=parseInt(document.getElementById("budgetRange")?.value||"300"),n=document.getElementById("groupType")?.value||"couple",s=parseInt(document.getElementById("groupSize")?.value||"2"),o=await this.config.planningManager.createPlan("AI Generated Trip","Automatically generated based on your preferences");t.textContent="Trip generated successfully!",this.showTripPlan(o),a.track("trip_generated",{duration:e,interests:i.length,budget:r,group_type:n,group_size:s})}catch(i){console.error("Trip generation failed:",i),t.textContent="Failed to generate trip. Please try again.",this.showError("Trip generation failed")}finally{e.disabled=!1,e.textContent="Generate Smart Trip"}}}setupSearchUI(){const e=document.getElementById("searchBtn"),t=document.getElementById("freeText");if(e&&t){const i=async()=>{const i=t.value.trim();if(i)try{e.textContent="Searching...",this.showSearchResults([]),a.track("search_performed",{query:i})}catch(r){console.error("Search failed:",r),this.showError("Search failed")}finally{e.textContent="Search"}};e.addEventListener("click",i),t.addEventListener("keypress",e=>{"Enter"===e.key&&i()})}document.querySelectorAll(".category-card").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-preset");t&&this.performQuickSearch(t)})})}setupUpdateUI(){if(!document.getElementById("updateNotification")){const e=document.createElement("div");e.id="updateNotification",e.className="update-notification hidden",document.body.appendChild(e)}}setupThemeToggle(){const e=document.getElementById("themeToggle");e&&e.addEventListener("click",()=>{this.emit("theme-toggle-clicked"),a.track("theme_toggle_clicked")})}showUpdateNotification(e){const t=document.getElementById("updateNotification");t&&(t.innerHTML=`\n      <div class="update-card">\n        <div class="update-header">\n          <h3>üéâ Update Available</h3>\n          <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.classList.add('hidden')">√ó</button>\n        </div>\n        <div class="update-content">\n          <p>Version ${e.latest} is available</p>\n          ${e.urgent?'<p class="urgent">‚ö†Ô∏è Important security update</p>':""}\n          <div class="update-actions">\n            <button class="btn-primary" onclick="window.updateManager.applyUpdate()">Update Now</button>\n            <button class="btn-secondary" onclick="this.parentElement.parentElement.parentElement.classList.add('hidden')">Later</button>\n          </div>\n        </div>\n      </div>\n    `,t.classList.remove("hidden"),a.track("update_notification_displayed",e))}showError(e){this.showNotification(e,"error")}showSuccess(e){this.showNotification(e,"success")}showNotification(e,t="info"){const i=document.createElement("div");i.className=`notification notification-${t}`,i.textContent=e,document.body.appendChild(i),setTimeout(()=>{i.remove()},3e3),a.track("notification_shown",{message:e,type:t})}handleAIResult(e,t){switch(e){case"plan_create":this.showTripPlan(t.plan);break;case"search":this.showSearchResults(t);break;case"weather":this.showWeatherInfo(t);break;default:console.log("AI result:",t)}}enterNavigationMode(){document.body.classList.add("navigation-mode"),this.currentView="navigation",this.emit("navigation-mode-entered")}exitNavigationMode(){document.body.classList.remove("navigation-mode"),this.emit("navigation-mode-exited")}getSelectedDuration(){const e=document.querySelector(".duration-option.selected");return parseInt(e?.getAttribute("data-duration")||"8")}getSelectedInterests(){const e=document.querySelectorAll(".interest-option.selected");return Array.from(e).map(e=>e.getAttribute("data-interest")).filter(Boolean)}showVoiceStatus(e){const t=document.getElementById("voiceStatus");t&&(t.textContent=e)}async performQuickSearch(e){try{a.track("quick_search_performed",{category:e})}catch(t){console.error("Quick search failed:",t),this.showError("Search failed")}}showTripPlan(e){const t=document.getElementById("enhancedTripDisplay");t&&(t.hidden=!1)}showSearchResults(e){const t=document.getElementById("list");t&&(0!==e.length?t.innerHTML=e.map(e=>`\n      <div class="result-card">\n        <h3>${e.name}</h3>\n        <p>${e.address||""}</p>\n        ${e.rating?`<div class="rating">‚≠ê ${e.rating}</div>`:""}\n      </div>\n    `).join(""):t.innerHTML='<div class="no-results">No results found</div>')}showWeatherInfo(e){console.log("Weather info:",e)}initializeTripPlanning(){}initializeAIInterface(){}initializeVoiceInterface(){}}const I=e("app",new class{config;providers={};managers={};aiOrchestrator;isInitialized=!1;constructor(){this.config={googleMapsApiKey:"demo_key_replace_with_real",openWeatherApiKey:"demo_key_replace_with_real",routingProvider:"google",weatherProvider:"openweather"}}async initialize(){if(!this.isInitialized){a.track("app_initialization_started");try{await this.initializeTheme(),await this.initializeProviders(),await this.initializeManagers(),await this.initializeUI(),await this.setupEventHandlers(),this.isInitialized=!0,a.track("app_initialization_completed"),setTimeout(()=>h.checkForUpdates(),2e3)}catch(e){throw a.track("app_initialization_failed",{error:e instanceof Error?e.message:"Unknown error"}),e}}}async initializeTheme(){const e=l.getEffectiveTheme();a.track("theme_initialized",{theme:e})}async initializeProviders(){if(this.config.googleMapsApiKey){const e=r(this.config.googleMapsApiKey);this.providers.googlePlaces=e.places,this.providers.googleRouting=e.routing}var e,t,i;"google"===this.config.routingProvider&&this.providers.googleRouting?this.providers.routing=this.providers.googleRouting:this.providers.routing=new d({baseUrl:e}),this.config.openWeatherApiKey&&(this.providers.weather=n(this.config.openWeatherApiKey)),this.providers.routing&&this.providers.weather&&(this.providers.weatherAwareRouter=(t=this.providers.routing,i=this.providers.weather,new u(t,i))),this.providers.places=this.providers.googlePlaces||{search:async()=>[],details:async()=>({}),photos:async()=>[]},a.track("providers_initialized",{routing:this.config.routingProvider,weather:this.config.weatherProvider,places:this.providers.googlePlaces?"google":"fallback"})}async initializeManagers(){var e,t,i;this.providers.places&&this.providers.routing&&this.providers.weather&&(this.aiOrchestrator=(e=this.providers.places,t=this.providers.routing,i=this.providers.weather,new g(e,t,i))),this.managers.map=new S({providers:this.providers}),this.managers.ui=new b({planningManager:f,voiceManager:k,navigationManager:P,aiOrchestrator:this.aiOrchestrator,providers:this.providers}),a.track("managers_initialized")}async initializeUI(){await this.managers.ui.initialize(),await this.managers.map.initialize(),a.track("ui_initialized")}async setupEventHandlers(){l.on("theme-changed",e=>{this.managers.map?.updateTheme(e.theme),a.track("theme_changed",{theme:e.theme})}),h.on("update-available",e=>{this.managers.ui?.showUpdateNotification(e),a.track("update_notification_shown",e)}),k.on("intent-recognized",async e=>{if(this.aiOrchestrator)try{const t=await this.aiOrchestrator.processVoiceIntent(e,{location:this.managers.map?.getCurrentLocation(),userPreferences:await this.getUserPreferences()});this.managers.ui?.handleAIResult(e.type,t)}catch(t){console.error("Voice intent processing failed:",t),this.managers.ui?.showError("Failed to process voice command")}}),P.on("navigation-started",()=>{this.managers.ui?.enterNavigationMode()}),P.on("navigation-stopped",()=>{this.managers.ui?.exitNavigationMode()}),window.addEventListener("error",e=>{this.managers.ui?.showError("An unexpected error occurred")}),a.track("event_handlers_setup")}async getUserPreferences(){return{language:navigator.language,units:"metric",categories:["meal","scenic","activity"]}}getProviders(){return this.providers}getManagers(){return this.managers}getAIOrchestrator(){return this.aiOrchestrator}isReady(){return this.isInitialized}})}}});
//# sourceMappingURL=app-legacy-Co19X7KT.js.map
